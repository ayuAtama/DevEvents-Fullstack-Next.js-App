// app/dashboard/page.tsx
import { Suspense } from "react";
import { auth } from "@/auth";
import { cacheLife } from "next/cache";
import Card from "@/Components/DashboardCard";

// ✅ Cached part (static UI)
async function CachedDashboardContent({ session }: { session: any }) {
  "use cache"; // must be first line
  cacheLife("hours");

  const cards = [
    {
      imageSrc: "/images/event-full.png",
      title: "Noteworthy technology acquisitions 2025",
      description:
        "Here are the biggest enterprise technology acquisitions of 2025 so far.",
      link: "/blog/tech-acquisitions",
    },
    {
      imageSrc: "/images/blog/image-2.jpg",
      title: "AI startups to watch",
      description: "A list of the most promising AI startups this year.",
      link: "/blog/ai-startups",
    },
    {
      imageSrc: "/images/blog/image-3.jpg",
      title: "Web development trends",
      description:
        "A look into the top frontend and backend trends shaping 2025.",
      link: "/blog/web-trends",
    },
    {
      imageSrc: "/images/blog/image-3.jpg",
      title: "Web development trends",
      description:
        "A look into the top frontend and backend trends shaping 2025.",
      link: "/blog/web-trends",
    },
    {
      imageSrc: "/images/blog/image-3.jpg",
      title: "Web development trends",
      description:
        "A look into the top frontend and backend trends shaping 2025.",
      link: "/blog/web-trends",
    },
    {
      imageSrc: "/images/blog/image-3.jpg",
      title: "Web development trends",
      description:
        "A look into the top frontend and backend trends shaping 2025.",
      link: "/blog/web-trends",
    },
    {
      imageSrc: "/images/blog/image-3.jpg",
      title: "Web development trends",
      description:
        "A look into the top frontend and backend trends shaping 2025.",
      link: "/blog/web-trends",
    },
    {
      imageSrc: "/images/blog/image-3.jpg",
      title: "Web development trends",
      description:
        "A look into the top frontend and backend trends shaping 2025.",
      link: "/blog/web-trends",
    },
    {
      imageSrc: "/images/blog/image-3.jpg",
      title: "Web development trends",
      description:
        "A look into the top frontend and backend trends shaping 2025.",
      link: "/blog/web-trends",
    },
  ];

  return (
    <div>
      <h1>Welcome, {session.user?.name ?? session.user?.username}</h1>
      <pre>{JSON.stringify(session, null, 2)}</pre>

      <div className="p-10">
        <div
          className="
          grid 
          gap-6 
          sm:grid-cols-2 
          lg:grid-cols-3
          justify-items-center
        "
        >
          {cards.map((card, index) => (
            <Card key={index} {...card} />
          ))}
        </div>
      </div>
    </div>
  );
}

// ✅ Dynamic wrapper to fetch the session
async function SessionLoader() {
  const session = await auth();

  if (!session) {
    return (
      <div>
        Please <a href="/signin">sign in</a> to view the dashboard.
      </div>
    );
  }

  return <CachedDashboardContent session={session} />;
}

// ✅ Main page component — not blocking
export default function Dashboard() {
  return (
    <Suspense fallback={<div>Loading your dashboard...</div>}>
      {/* This async component is wrapped, so it won’t block */}
      <SessionLoader />
    </Suspense>
  );
}
